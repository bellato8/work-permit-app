// ======================================================================
// File: web/vite.config.ts
// ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô: 2025-10-30 (Asia/Bangkok)
// ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î: ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏Å‡πà‡∏≤‡∏û‡∏≠‡∏™‡∏°‡∏Ñ‡∏ß‡∏£ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ä‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
//  - ‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏•‡∏±‡πä‡∏Å‡∏≠‡∏¥‡∏ô "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤" ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô build ‡πÇ‡∏õ‡∏£‡∏î‡∏±‡∏Å‡∏ä‡∏±‡∏ô
//  - ‡∏ï‡∏±‡πâ‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡∏™‡∏°‡∏î‡∏∏‡∏• (‡∏¢‡∏±‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏° Chrome/Firefox ‡πÄ‡∏Å‡πà‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£)
//  - ‡∏ï‡∏±‡πâ‡∏á cssTarget ‡πÄ‡∏õ‡πá‡∏ô 'chrome61' ‡∏Å‡∏±‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏µ/‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏µ‡πâ‡∏¢‡∏ô‡πÉ‡∏ô‡∏£‡∏∏‡πà‡∏ô‡πÄ‡∏Å‡πà‡∏≤
//  - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î .env.development ‡πÅ‡∏•‡∏∞ .env.production ‡∏ï‡∏≤‡∏° mode
// ======================================================================

import { defineConfig, loadEnv } from 'vite'
import react from '@vitejs/plugin-react'
import legacy from '@vitejs/plugin-legacy'

export default defineConfig(({ mode }) => {
  // ‡πÇ‡∏´‡∏•‡∏î .env ‡∏ï‡∏≤‡∏° mode (development ‡∏´‡∏£‡∏∑‡∏≠ production)
  const env = loadEnv(mode, process.cwd(), '')
  const isProd = mode === 'production'

  console.log('üîß Vite Mode:', mode)
  console.log('üéØ Target Project:', env.VITE_FIREBASE_PROJECT_ID || 'unknown')

  return {
    plugins: [
      react(),

      // ‡πÇ‡∏´‡∏•‡∏î "‡∏Ç‡∏≠‡∏á‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤" ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô‡πÇ‡∏õ‡∏£‡∏î‡∏±‡∏Å‡∏ä‡∏±‡∏ô (‡∏ï‡∏≠‡∏ô dev ‡πÉ‡∏´‡πâ‡πÑ‡∏ß‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≤)
      ...(isProd
        ? [legacy({
            // ‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡∏™‡∏°‡∏î‡∏∏‡∏• (‡πÄ‡∏Å‡πà‡∏≤‡∏û‡∏≠‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏•‡∏≤‡∏Å‡πÑ‡∏õ‡πÑ‡∏Å‡∏•‡∏à‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ö‡∏ß‡∏°‡∏≤‡∏Å)
            targets: [
              'defaults',
              'not dead',
              'Chrome >= 61',
              'Firefox >= 68',
              'Safari >= 12',
              'iOS >= 12',
            ],

            // ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏ï‡∏¥‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≤‡∏î "‡πÅ‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥"
            modernPolyfills: true,

            // ‡πÄ‡∏ï‡∏¥‡∏°‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏û‡∏ß‡∏Å async/await ‡πÉ‡∏´‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πà‡∏≤‡∏°‡∏≤‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à
            additionalLegacyPolyfills: ['regenerator-runtime/runtime'],
          })]
        : []),
    ],

    build: {
      // ‡πÉ‡∏´‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏•‡∏±‡∏Å‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢‡∏û‡∏≠‡∏Ñ‡∏ß‡∏£ (‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà, ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏¢‡πâ‡∏≠‡∏ô‡∏¢‡∏∏‡∏Ñ‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ)
      target: 'es2017',

      // ‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö CSS ‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏∏‡πà‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÉ‡∏ô‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£ (‡∏Å‡∏±‡∏ô‡∏™‡∏µ/‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÅ‡∏õ‡∏•‡∏Å‡πÜ ‡∏ö‡∏≤‡∏á‡πÄ‡∏Ñ‡∏™)
      cssTarget: 'chrome61',

      // ‡∏ï‡∏≠‡∏ô dev ‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏Ñ‡πâ‡∏î‡πÑ‡∏ß‡πâ‡∏™‡∏∑‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏á‡πà‡∏≤‡∏¢ / ‡πÇ‡∏õ‡∏£‡∏î‡∏±‡∏Å‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏•‡πá‡∏Å
      sourcemap: !isProd,
    },

    // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ Vite expose ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ env ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ VITE_
    define: {
      'import.meta.env.VITE_FIREBASE_PROJECT_ID': JSON.stringify(env.VITE_FIREBASE_PROJECT_ID),
      'import.meta.env.VITE_FIREBASE_API_KEY': JSON.stringify(env.VITE_FIREBASE_API_KEY),
      // ... ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
    },
  }
})
